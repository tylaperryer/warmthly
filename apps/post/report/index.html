<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    // API Configuration - Set before other scripts load
    window.API_BASE_URL = 'https://backend.warmthly.org';
  </script>
  <script type="module" src="/lego/components/warmthly-head.js"></script>
  <script type="module" src="/lego/components/warmthly-header.js"></script>
  <script type="module" src="/lego/components/warmthly-stoplight.js"></script>
  <script type="module" src="/lego/components/warmthly-reading-level.js"></script>
  <script type="module" src="/lego/components/warmthly-font-loader.js"></script>
  <script type="module" src="/lego/components/warmthly-breadcrumb.js"></script>
  <script type="module" src="/lego/components/warmthly-language-switcher.js"></script>
  <script type="module" src="/lego/utils/init.js"></script>
  <script type="module">
    import { initReadingLevel } from '/lego/utils/reading-level.js';
    import { initAbbreviations } from '/lego/utils/abbreviations.js';
    import { initGlossary } from '/lego/utils/glossary.js';
    import { initPronunciation } from '/lego/utils/pronunciation.js';
    initReadingLevel();
    initAbbreviations();
    initGlossary();
    initPronunciation();
  </script>
  <warmthly-head 
    title="Report - Warmthly"
    description="Report concerns or issues with Warmthly's operations or transparency"
    app="post"
    viewport="1.0"
    preconnects="https://www.warmthly.org, https://post.warmthly.org">
  </warmthly-head>
  
  <style>
    /* Hide body until CSS loads to prevent FOUC */
    body:not(.css-loaded) {
      visibility: hidden;
      opacity: 0;
    }
    body.css-loaded {
      visibility: visible;
      opacity: 1;
      transition: opacity 0.2s ease-in-out;
    }
  </style>
  
</head>
<body class="fonts-loading">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <warmthly-header app="post"></warmthly-header>
  
  <div style="display: flex; gap: 1rem; justify-content: flex-end; padding: 1rem; align-items: center;">
    <warmthly-language-switcher></warmthly-language-switcher>
    <warmthly-reading-level></warmthly-reading-level>
    <warmthly-stoplight app="post"></warmthly-stoplight>
  </div>
  <warmthly-breadcrumb></warmthly-breadcrumb>

  <div class="container container-narrow" id="main-content" role="main">
    <h1 class="page-title" data-reading-level-content>Report an Issue</h1>
    <p class="main-text" data-reading-level-content>
      If you have concerns, questions, or need to report something related to Warmthly, please use the form below. We take all reports seriously and will review them promptly.
    </p>

    <div class="section">
        <h2 class="section-title" data-reading-level-content>Your Voice Matters</h2>
        <p data-reading-level-content>
            Transparency and accountability are core to our mission. If you've witnessed something that doesn't align with our values—Transparency, Honesty, Humility, and Empathy—we want to know. Your report will be reviewed by our team and addressed appropriately.
        </p>
        
        <div class="info-box">
          <p data-reading-level-content><strong>Note:</strong> All reports are reviewed confidentially. We take every concern seriously and will investigate all valid reports thoroughly.</p>
        </div>
        
        <form class="report-form" id="reportForm">
          <div class="form-group">
            <label for="reportName" class="form-label">Your Name</label>
            <input type="text" id="reportName" class="form-input" placeholder="Enter your name" required />
          </div>
          
          <div class="form-group">
            <label for="reportEmail" class="form-label">Your Email</label>
            <input type="email" id="reportEmail" class="form-input" placeholder="your.email@example.com" required />
          </div>
          
          <div class="form-group">
            <label for="reportType" class="form-label">Report Type</label>
            <select id="reportType" class="form-input" required>
              <option value="">Select a type...</option>
              <option value="media">Media Inquiry</option>
              <option value="concern">Concern or Complaint</option>
              <option value="admin">Administrative Issue</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="reportMessage" class="form-label">Message</label>
            <textarea id="reportMessage" class="form-textarea" placeholder="Please describe your issue or inquiry in detail..." required></textarea>
          </div>
          
          <div class="success-message" id="successMessage" role="alert" aria-live="polite">Thank you for your report. We've received your message and will review it promptly.</div>
          <div class="error-message" id="errorMessage" role="alert" aria-live="polite"></div>
          
          <button type="submit" class="submit-button" id="submitButton">Submit Report</button>
        </form>
    </div>
  </div>
  
  <!-- Font Loader Component -->
  <warmthly-font-loader></warmthly-font-loader>

  <script>
    const reportForm = document.getElementById('reportForm');
    const submitButton = document.getElementById('submitButton');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      successMessage.style.display = 'none';
    }
    
    function showSuccess() {
      successMessage.style.display = 'block';
      errorMessage.style.display = 'none';
    }
    
    function hideMessages() {
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
    }
    
    reportForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideMessages();
      
      const formData = {
        name: document.getElementById('reportName').value.trim(),
        email: document.getElementById('reportEmail').value.trim(),
        type: document.getElementById('reportType').value,
        message: document.getElementById('reportMessage').value.trim()
      };
      
      if (!formData.name || !formData.email || !formData.type || !formData.message) {
        showError('Please fill in all required fields.');
        return;
      }
      
      if (!formData.email.includes('@')) {
        showError('Please enter a valid email address.');
        return;
      }
      
      submitButton.disabled = true;
      submitButton.textContent = 'Submitting...';
      
      try {
        const apiBase = window.API_BASE_URL || 'https://backend.warmthly.org';
        const response = await fetch(`${apiBase}/api/reports`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.error?.message || 'Failed to submit report');
        }
        
        showSuccess();
        reportForm.reset();
        
        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.textContent = 'Submit Report';
          hideMessages();
        }, 3000);
        
      } catch (error) {
        showError('Failed to submit report. Please try again or contact us directly.');
        submitButton.disabled = false;
        submitButton.textContent = 'Submit Report';
      }
    });

  </script>
</body>
</html>

